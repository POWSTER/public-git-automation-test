{"version":3,"file":"js/trailerOverlay.bolt.js?v=1bb1dbca063b24401f6e","mappings":"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","sources":["webpack://thundr/./static/src/components/bolt/trailerOverlay/trailerOverlay.js","webpack://thundr/./static/src/components/bolt/trailerOverlay/trailerOverlay.sss?570d"],"sourcesContent":["import { h, Component } from 'preact';\nimport s from 'components/bolt/trailerOverlay/trailerOverlay.sss';\nimport BurgerMenu from 'components/bolt/burgerMenu/burgerMenu';\nimport 'store/bolt/trailerOverlay';\nimport { joinClasses, accessNested } from 'utils/utils';\nimport parseQueryString from 'utils/parseQueryString';\nimport VideoPlayer from 'components/bolt/videos/player';\nimport Store from 'store/store';\nimport HTML from 'components/core/html/html';\n\nexport default class TrailerOverlay extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tclosed: false,\n\t\t\tvideoLoaded: false\n\t\t};\n\n\t\tthis.handleLoaded = this.handleLoaded.bind(this);\n\t\tthis.toggleOverlayOpen = this.toggleOverlayOpen.bind(this);\n\t\tthis.checkIfOverlayShouldShow = this.checkIfOverlayShouldShow.bind(this);\n\n\t\tthis.disabled = parseQueryString()['no-overlay'];\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.checkIfOverlayShouldShow(null, true);\n\t\tStore.on('SET_ACTIVE_PAGE', this.checkIfOverlayShouldShow);\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.clearTimeout(this.timeout);\n\t\tStore.off('SET_ACTIVE_PAGE', this.checkIfOverlayShouldShow);\n\t\tthis.toggleOverlayOpen(false);\n\t}\n\n\tcheckIfOverlayShouldShow(activePage) {\n\t\tif (this.props.manual) {\n\t\t\treturn;\n\t\t}\n\n\t\twindow.clearTimeout(this.timeout);\n\n\t\tconst overlayTriggered = accessNested(this.props, 'store.trailerOverlay.overlayTriggered', false);\n\t\tconst disableForGoogleBot = accessNested(this.props, 'data.disableForGoogleBot', false);\n\t\tconst isGoogleBot = /Googlebot/i.test(navigator.userAgent);\n\n\t\tif (overlayTriggered || (disableForGoogleBot && isGoogleBot)) return;\n\n\t\tif (!activePage) activePage = accessNested(this.props, 'store.activePage');\n\t\t//let inclusions = accessNested(this.props, 'data.inclusions', '');\n\t\tlet inclusions = accessNested(this.props, 'store.appData.options.videoOverlay.inclusions', '');\n\n\t\tif (inclusions) {\n\t\t\tinclusions = inclusions.split(',').map(page => page.trim());\n\t\t}\n\n\t\tif ((inclusions.length === 0 || inclusions.indexOf(activePage) > -1) && !this.disabled) {\n\t\t\tconst delay = accessNested(this.props, 'store.appData.options.videoOverlay.delay', 0);\n\n\t\t\tthis.timeout = window.setTimeout(() => {\n\t\t\t\tthis.toggleOverlayOpen(true);\n\t\t\t}, delay * 1000);\n\t\t}\n\t}\n\n\ttoggleOverlayOpen(open, e) {\n\t\tif (!open && e?.target?.id === 'youtubeCookieSettings') {\n\t\t\treturn;\n\t\t}\n\t\tif (open) {\n\t\t\tthis.overlayOpenAt = Date.now();\n\t\t} else {\n\t\t\tlet now = Date.now();\n\t\t\tlet openAt = this.overlayOpenAt || now;\n\t\t\tlet duration = Math.floor((now - openAt) / 10) * 10;\n\t\t\tif (duration > 100) {\n\t\t\t\tduration = '100+';\n\t\t\t}\n\t\t\tStore.emit('POWSTER_GA_EVENT_TRACK', 'trailer-bounce', 'trailer', duration);\n\t\t}\n\n\t\tif (e?.target && !e.target.className?.includes('burgerMenu') && !e.target.className.includes(s.wrapper)) {\n\t\t\treturn;\n\t\t}\n\n\t\tStore.emit('TOGGLE_TRAILER_OVERLAY', open);\n\t}\n\n\thandleLoaded() {\n\t\tthis.setState({ videoLoaded: true });\n\t}\n\n\trender() {\n\t\tconst { videoLoaded } = this.state;\n\t\tconst { store } = this.props;\n\t\tlet { overlayOpen, data } = store?.trailerOverlay || {};\n\n\t\tif (this.disabled) {\n\t\t\toverlayOpen = false;\n\t\t}\n\n\t\tconst fontVariables = accessNested(store, 'appData.styling.fontVariables.galleryAnnotations', {});\n\t\tconst { video, annotation } = data || {};\n\t\tlet videoSubObject = video && Object.values(video).find(value => value && typeof value === 'object');\n\t\t// If the video object is not nested, consider it to be the video data itself, otherwise take the first subobject\n\t\tlet activeVideo = videoSubObject || video;\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclass={joinClasses(s.wrapper, (videoLoaded && overlayOpen) && s.visible)}\n\t\t\t\tonClick={(e) => this.toggleOverlayOpen(false, e)}\n\t\t\t>\n\t\t\t\t<BurgerMenu\n\t\t\t\t\ttype={overlayOpen ? 'close' : 'burger'}\n\t\t\t\t\ttrailerOverlay\n\t\t\t\t\textraClass={s.closeButton}\n\t\t\t\t/>\n\t\t\t\t{overlayOpen && (\n\t\t\t\t\t<VideoPlayer\n\t\t\t\t\t\tref={ref => this.player = ref}\n\t\t\t\t\t\textraClass={s.player}\n\t\t\t\t\t\tactiveVideo={activeVideo}\n\t\t\t\t\t\tonEnded={() => this.toggleOverlayOpen(false)}\n\t\t\t\t\t\tonLoaded={this.handleLoaded}\n\t\t\t\t\t\thiddenPlaylist\n\t\t\t\t\t\toverrideStyles\n\t\t\t\t\t\tisTrailerOverlay\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{annotation && (\n\t\t\t\t\t<div style={fontVariables.galleryAnnotations} class={s.annotation}>\n\t\t\t\t\t\t<HTML markdown content={annotation} />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n}","// extracted by mini-css-extract-plugin\nexport default {\"wrapper\":\"trailerOverlay__wrapper__Zyq6X\",\"visible\":\"trailerOverlay__visible__rtQYQ\",\"closeButton\":\"trailerOverlay__closeButton__EjUap\",\"player\":\"trailerOverlay__player__tDaXY\",\"annotation\":\"trailerOverlay__annotation__TnTkr\"};"],"names":["h","Component","s","BurgerMenu","joinClasses","accessNested","parseQueryString","VideoPlayer","Store","HTML","TrailerOverlay","constructor","props","state","closed","videoLoaded","handleLoaded","bind","toggleOverlayOpen","checkIfOverlayShouldShow","disabled","componentDidMount","on","componentWillUnmount","window","clearTimeout","timeout","off","activePage","manual","overlayTriggered","disableForGoogleBot","isGoogleBot","test","navigator","userAgent","inclusions","split","map","page","trim","length","indexOf","delay","setTimeout","open","e","target","id","overlayOpenAt","Date","now","openAt","duration","Math","floor","emit","className","includes","wrapper","setState","render","store","overlayOpen","data","trailerOverlay","fontVariables","video","annotation","videoSubObject","Object","values","find","value","activeVideo","class","visible","onClick","type","extraClass","closeButton","ref","player","onEnded","onLoaded","hiddenPlaylist","overrideStyles","isTrailerOverlay","style","galleryAnnotations","markdown","content"],"sourceRoot":""}